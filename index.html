<!DOCTYPE html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <title>Quiz</title>

    <!-- Bootstrap -->
	<link href="bootstrap-5.0.1/css/bootstrap.min.css" rel="stylesheet">
		
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
		
	<!-- jQuery -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
	<script src="bootstrap-5.0.1/js/bootstrap.min.js"></script>
		
	<!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
		<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->

</head>
<body class="bg-dark">

    <div class="container">
        <div id="signIn" class="row">
            <div class="col-md-4 offset-md-4">
                <div class="login-form bg-light mt-4 p-4">
                    <div class="row g-4">
                        <h4 class="text-center">Login</h4>
                        <label id="signInMessage"></label>
                        <div class="col-12">
                            <label>Login</label>
                            <input type="text" id="email" class="form-control" placeholder="Email">
                        </div>
                        <div class="col-12">
                            <label>Senha</label>
                            <input type="password" id="password" class="form-control" placeholder="Senha">
                        </div>
                        <div class="d-flex justify-content-center">
                            <button id="signInButton" class="col-12 btn btn-primary rounded-pill">Login</button>
                        </div>
                    </div>
                    <hr class="mt-4">
                    <div class="col-12">
                        <p class="text-center mb-0">Não possui uma conta? <a id="signUpForm" href="#">Cadastrar-se</a></p>
                    </div>
                </div>
            </div>
        </div>

        <div id="signUp" class="row">
            <div class="col-md-4 offset-md-4">
                <div class="login-form bg-light mt-4 p-4">
                    <div class="row g-4">
                        <h4 class="text-center">Cadastrar-se</h4>
                        <label id="signUpMessage"></label>
                        <div class="col-12">
                            <label>Nome</label>
                            <input type="text" id="newName" class="form-control" placeholder="Nome">
                        </div>
                        <div class="col-12">
                            <label>Login</label>
                            <input type="text" id="newEmail" class="form-control" placeholder="Email">
                        </div>
                        <div class="col-12">
                            <label>Senha</label>
                            <input type="password" id="newPassword" class="form-control" placeholder="Senha">
                        </div>
                        <div class="d-flex justify-content-center">
                            <button id="signUpButton" class="col-12 btn btn-secondary rounded-pill">Cadastrar</button>
                        </div>
                    </div>
                    <hr class="mt-4">
                    <div class="col-12">
                        <p class="text-center mb-0">Já Possui conta? <a id="signInForm" href="#">Entrar</a></p>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script type="module">
        // Importando funções do firebase 
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.2/firebase-app.js";
        import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/9.0.2/firebase-firestore.js";
        import { getAuth, createUserWithEmailAndPassword, setPersistence, 
            signInWithEmailAndPassword, browserSessionPersistence } 
            from "https://www.gstatic.com/firebasejs/9.0.2/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCRPfI1Mkrhcta15kWTzBFQeslztvMUPIU",
            authDomain: "form-f5d6e.firebaseapp.com",
            databaseURL: "https://form-f5d6e-default-rtdb.firebaseio.com",
            projectId: "form-f5d6e",
            storageBucket: "form-f5d6e.appspot.com",
            messagingSenderId: "391345569169",
            appId: "1:391345569169:web:68dc5bdb320cc39b072e30",
            measurementId: "G-6NLYV6PCDL"
        };
      
        // Inicializa o banco
        initializeApp(firebaseConfig);

        // Conecta ao firestore 
        const db = getFirestore();

        // Inicializa o controle de autorização 
        const auth = getAuth();

        // Permite com que as sessões permaneçam entre as páginas 
        setPersistence(auth, browserSessionPersistence);

        // Associa os botões principais 
        const loginButton = document.querySelector("#signInButton");
        const createButton = document.querySelector("#signUpButton");
        
        // Mesagens de erro 
        const loginMessage = document.querySelector("#signInMessage");
        const signUpMessage = document.querySelector("#signUpMessage");

        // Formulario de login 
        const email = document.querySelector("#email");
        const password = document.querySelector("#password");

        // Formulario de cadastro 
        const newName = document.querySelector("#newName");
        const newEmail = document.querySelector("#newEmail");
        const newPassword = document.querySelector("#newPassword");
        
        // Faz login na conta do usuário 
        loginButton.addEventListener("click", e => {
            signInWithEmailAndPassword(auth, email.value, password.value)
            .then((userCredential) => {
                
                // Abre a página de usuário 
                window.open("./usuario.html","_self");
            }).catch((error) => {
                loginMessage.innerHTML = "<span style='color: red;'>Dados inválidos</span>";
                console.log(error.code);
                console.log(error.message);
            });
        });

        // Cadastra novos usuários 
        createButton.addEventListener("click", e=> {
            createUserWithEmailAndPassword(auth, newEmail.value, newPassword.value)
            .then((userCredential) => {

                // Cria uma base de dados para o usuário 
                let dado = doc(db, "user", userCredential.user.uid);
                setDoc(dado, { nome: newName.value, email: newEmail.value });

                signUpMessage.innerHTML = "<span style='color: green;'>Usuário cadastrado</span>";
                console.log("Usuário Cadastrado Com Sucesso!");

            }).catch((error) => {
                
                signUpMessage.innerHTML = "<span style='color: red;'>Dados inválidos</span>";
                console.log(error.code);
                console.log(error.message);
            });
        });
    </script>
    <script src="./js/index.js"></script>
</body>